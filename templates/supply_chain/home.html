{% extends "supply_chain/base.html" %}
{% load static humanize %}

{% block title %}Home — The Digital Council{% endblock %}

{% block content %}
{# Hero removed per user request. Page now surfaces upcoming meetings then featured projects. #}

{# include cost-of-living hero card (prominent) #}
{% include 'supply_chain/cost_of_living_card.html' %}

<section id="meetings" class="pressable-section card" style="margin-top:0.5rem;padding:0.75rem;border-radius:8px;">
  <h3>Upcoming meetings &amp; events <small style="float:right"><a href="{% url 'calendar' %}">View calendar</a></small></h3>
  {% if meetings %}
    <div style="margin-top:0.5rem">
      <div class="meetings-wrapper">
        <div class="project-grid meetings-grid">
          {% for meet in meetings %}
            <a href="{% url 'meeting-detail' meet.pk %}" class="project meeting-card card" style="padding:0;margin:0;display:block;color:inherit;text-decoration:none">
              <div class="meeting-inner" style="display:flex;align-items:flex-start;gap:0.75rem;">
                <div class="meeting-badge" aria-hidden="true">
                  <div class="badge-day">{{ meet.date|date:"j" }}</div>
                  <div class="badge-mon">{{ meet.date|date:"M" }}</div>
                </div>
                <div class="card-content" style="padding:0.6rem 0.6rem 0.6rem 0;">
                  <p class="title is-5">{{ meet.date|date:"j M Y" }}{% if meet.time %} — {{ meet.time|time:"H:i" }}{% endif %}</p>
                  <p class="subtitle is-6 muted">{% if meet.council %}{{ meet.council.name }}{% else %}Council{% endif %}{% if meet.location %} &middot; {{ meet.location }}{% endif %}</p>
                  <div class="content">
                    <p class="muted">{{ meet.agenda|truncatewords:18 }}</p>
                  </div>
                </div>
              </div>
            </a>
          {% endfor %}
        </div>
        <p style="margin-top:0.5rem"><a href="{% url 'calendar' %}">See full calendar</a></p>
      </div>
    </div>
  {% else %}
    <p class="muted">No upcoming meetings scheduled.</p>
  {% endif %}
</section>


<section id="projects" style="margin-top:1.25rem;">
  <h3>Featured projects</h3>
  {% if projects %}
    <div class="project-grid">
      {% for project in projects %}
        <article class="project card">
          {% if project.main_image %}
            <div class="card-image">
              <figure class="image is-4by3">
                <img src="{{ project.main_image }}" alt="{{ project.title }}">
              </figure>
            </div>
          {% elif project.image %}
            <div class="card-image">
              <figure class="image is-4by3">
                <img src="{{ project.image }}" alt="{{ project.title }}">
              </figure>
            </div>
          {% else %}
            <div class="card-image">
              <figure class="image is-4by3">
                <img src="{% static 'img/project-default.svg' %}" alt="{{ project.title }}">
              </figure>
            </div>
          {% endif %}

          <div class="card-content">
            <div class="media">
              <div class="media-content">
                <p class="title is-5"><a href="{% url 'project-detail' project.pk %}">{{ project.title }}</a></p>
                <p class="subtitle is-6 muted">{{ project.created_at|date:"j M Y" }}</p>
              </div>
            </div>

            <div class="content">
              {% if project.category %}
                <span class="tag is-info is-light">{{ project.category.name }}</span>
              {% endif %}
              {% if project.location %}
                <span class="muted" style="margin-left:0.5rem">{{ project.location }}</span>
              {% endif %}

              <p class="muted" style="margin-top:0.5rem">{{ project.description|truncatewords:20 }}</p>
            </div>
            <div class="has-text-right" style="margin-top:0.75rem">
              <a href="{% url 'project-detail' project.pk %}" class="button is-link is-small">View</a>
            </div>
          </div>
        </article>
      {% endfor %}
    </div>
    <p><a href="{% url 'projects-list' %}">See all projects</a></p>
  {% else %}
    <p class="muted">No projects available yet. <a href="{% url 'projects-list' %}">Browse projects</a></p>
  {% endif %}
</section>

{% endblock %}
<section class="columns">
  <div class="col">
    <h3>Latest work</h3>
    <div class="content">
      <article>
        <p><strong>Pilot Scheme for AI-Driven Logistics</strong><br>
        Trialling AI route-optimisation to coordinate deliveries, reduce waiting times and lower carbon emissions across multi-site construction programmes.
        <br><a href="{% url 'projects-list' %}" class="is-size-7">Read More</a></p>
      </article>

      <article>
        <p><strong>Modular Materials Warehouse Trial</strong><br>
        Testing local modular storage hubs that decentralise inventory, cut lead times and improve just-in-time delivery for busy urban roadworks and site builds.
        <br><a href="{% url 'projects-list' %}" class="is-size-7">Read More</a></p>
      </article>

      <article>
        <p><strong>Real-time Traffic Management Integration</strong><br>
        Integrating traffic sensor feeds with logistics schedules to reschedule deliveries dynamically, minimising disruption and improving on-time site access.
        <br><a href="{% url 'projects-list' %}" class="is-size-7">Read More</a></p>
      </article>
    </div>
  </div>
  <div class="col">
    <nav class="panel">
      <p class="panel-heading">Community</p>
      <p class="panel-block">
        <span class="muted">Resources and portals for key stakeholders involved in public-sector construction projects.</span>
      </p>

      <a class="panel-block" href="{% url 'supplier-list' %}">
        <span class="panel-icon"><i class="fas fa-landmark" aria-hidden="true"></i></span>
        Local Council Partner Portal
      </a>

      <a class="panel-block" href="{% url 'supplier-list' %}">
        <span class="panel-icon"><i class="fas fa-user-check" aria-hidden="true"></i></span>
        Contractor Registration
      </a>

      <a class="panel-block" href="{% url 'design-about' %}">
        <span class="panel-icon"><i class="fas fa-file-alt" aria-hidden="true"></i></span>
        Supply Chain Standards &amp; Documentation
      </a>

      <a class="panel-block" href="{% url 'contact' %}">
        <span class="panel-icon"><i class="fas fa-chart-line" aria-hidden="true"></i></span>
        Economic Impact Reports
      </a>
    </nav>
  </div>
</section>
